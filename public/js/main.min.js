function getRandomName(){return firstNameList[Math.floor(Math.random()*firstNameList.length)]+" "+lastNameList[Math.floor(Math.random()*lastNameList.length)]}function addNewMessageToChatbox(e,t,n,o,i,s){s=s||new Date(Date.now());let m={_msgId:e,_userId:t,_nickname:n,_newMessage:o,_imgLink:i,_time:s},r=createMsgElement(m);document.getElementById("all-msg").append(htmlToElement(r)),setFocusOnDivWithId(e)}function addNewMessageToNoti(e,t,n,o,i,s){s=s||new Date(Date.now());let m={_msgId:e,_userId:t,_nickname:n,_newMessage:o,_imgLink:i,_time:s},r=createMsgElement(m);document.getElementById("noti-msg").append(htmlToElement(r)),setFocusOnDivWithId(e)}function addOlderMessage(e,t,n,o,i,s){let m={_msgId:e,_userId:t,_nickname:n,_newMessage:o,_imgLink:i,_time:s},r=createMsgElement(m);document.getElementById("all-msg").insertBefore(htmlToElement(r),document.getElementById("all-msg").firstChild)}function createMsgElement(e){const{_msgId:t,_userId:n,_nickname:o,_newMessage:i,_imgLink:s,_time:m}={...e};let r=!1;n===getCookie("id")&&(r=!0);let a=`\n  <li id="${t}" class="msg-item ${r?"owner":""}">\n      <span class="msg-name">\n      ${o} <span style="font-family: Sans-serif; font-weight: 300; font-size:12px; color:#b2bec3;">\n      ${renderTime(m)} </span> \n  </span>\n    <span class="msg-text">${i}</span>\n    ${s?'<div>\n            <img src="" alt="img">\n           </div>':""}\n</li>\n  `;return a}function htmlToElement(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content.firstChild}function setFocusOnDivWithId(e){document.getElementById(e).scrollIntoView({behavior:"smooth",block:"center"})}function renderTime(e){let t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],n=e.getDate(),o=e.getHours(),i=e.getMinutes();return`${t} ${n<10?"0"+n:n} ${o<10?"0"+o:o}:${i<10?"0"+i:i}`}async function getMessage(e){const t=await fetch("/msg?_p="+e,{method:"get",cache:"no-cache",redirect:"follow",referrerPolicy:"no-referrer"});return t.json()}function sendMessage(e){let t=document.getElementById("client-name").value,n={userId:getCookie("id"),name:t||getRandomName(),msg:e};socket.emit("message",JSON.stringify(n))}function isInViewport(e,t){const n=e.getBoundingClientRect(),o=t.getBoundingClientRect();return n.top>=o.top&&n.left>=o.left&&n.bottom<=o.bottom&&n.right<=o.right}function scrollListener(){let e=isInViewport(document.getElementById("all-msg").firstChild,document.getElementById("all-msg"));e&&!msgPending&&(msgPending=!0,getMessage(msgPage).then(e=>{if(!0===e.success){const t=e.query;t.map(e=>{addOlderMessage(e._id,e.userId,e.name,e.msg,e.imgLink,new Date(e.time))});let n=parseInt(e.page);msgPage=n+1,msgPending=!1}}).catch(e=>{}))}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function setCookie(e,t,n){const o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);let i="expires="+o.toUTCString();document.cookie=e+"="+t+";"+i+";path=/"}function getUsername(){return document.getElementById("client-name").value||getRandomName()}function getCookie(e){let t=e+"=",n=decodeURIComponent(document.cookie),o=n.split(";");for(let e=0;e<o.length;e++){let n=o[e];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}async function getPreviousName(e){const t=await fetch(`/name/${e}`,{method:"get",cache:"no-cache",redirect:"follow",referrerPolicy:"no-referrer"});return t.json()}const SERVER_URI="https://xinchao2022.herokuapp.com";var msgPage=1,msgPending=!0,fireworkLimit=2,fireworkCounter=0;import{happynewyear}from"./firework.min.js";var deadline=new Date("feb 1, 2022 00:00:00").getTime(),coundownCongrate=new Audio("../firework/Countdown-Happy-New-Year.mp3"),hpnyMusic=new Audio("../firework/HPNY-sound.mp3"),x=setInterval(function(){var e=(new Date).getTime(),t=deadline-e,n=Math.floor(t/864e5),o=Math.floor(t%864e5/36e5),i=Math.floor(t%36e5/6e4),s=Math.floor(t%6e4/1e3);document.getElementById("day").innerHTML=n<10?`0${n}`:`${n}`,document.getElementById("hour").innerHTML=o<10?`0${o}`:`${o}`,document.getElementById("minute").innerHTML=i<10?`0${i}`:`${i}`,document.getElementById("second").innerHTML=s<10?`0${s}`:`${s}`,t<=11e3&&coundownCongrate.play(),t<=0&&(clearInterval(x),document.getElementById("time-up").innerHTML="🎉🧨🎆🎉 CHÚC MỪNG NĂM MỚI 🧨🎊🎋🎇",document.getElementById("countdown-block--header").innerHTML="HAPPY NEW YEAR 2022 !",document.getElementById("day").innerHTML="---",document.getElementById("hour").innerHTML="---",document.getElementById("minute").innerHTML="---",document.getElementById("second").innerHTML="---",happynewyear(),hpnyMusic.play(),fireworkLimit=20)},1e3),firstNameList=["Mèo","Chuột","Cún","Heo","Cá","Gà","Nhím","Sóc","Thỏ","Yasuo","Ánh sáng","Lợn"],lastNameList=["Xanh","Đen","Nâu","Hồng","Vàng","Ngu","Xinh","Vui Vẻ","Nướng","Vị Chanh","Đáng Yêu","Xào Sả Ớt","Hầm Lá Ngải"],nickNameForm=document.getElementById("client-name");nickNameForm.value=getRandomName();var msgForm=document.getElementById("chatbox-form"),msg=document.getElementById("message");msg.focus(),msgForm.addEventListener("submit",e=>{const t=new FormData(e.target);e.preventDefault();let n=t.get("message");n&&sendMessage(n),msg.value="",msg.focus()}),getMessage(0).then(e=>{if(!0===e.success){const t=e.query;t.map(e=>{addOlderMessage(e._id,e.userId,e.name,e.msg,e.imgLink,new Date(e.time))}),setFocusOnDivWithId(t[0]._id),msgPending=!1}}).catch(e=>{}),document.getElementById("all-msg").addEventListener("scroll",scrollListener),getCookie("id")||setCookie("id",uuidv4(),14),getPreviousName(getCookie("id")).then(e=>{e.success?document.getElementById("client-name").value=e.name:document.getElementById("client-name").value=getRandomName()});var socket=io(SERVER_URI);socket.on("connect",()=>{socket.emit("status",`${getCookie("id")} connected`)}),socket.on("online",e=>{document.getElementById("online-counter").innerHTML=JSON.parse(e).count}),socket.on("message",e=>{let t=JSON.parse(e);addNewMessageToChatbox(t._id||uuidv4(),t.userId,t.name,t.msg,t.imgLink,new Date(t.time||Date.now()))}),socket.on("fireworks",e=>{let t=JSON.parse(e);t.userId!==getCookie("id")&&fireworksPowered(),addNewMessageToNoti(uuidv4(),t.userId,t.name,"Vừa bắn 1 quả pháo hoa",null,new Date(Date.now()))}),socket.on("test",e=>{}),document.getElementById("fireworks-btn").addEventListener("click",()=>{fireworksPowered();let e={userId:getCookie("id"),name:getUsername()};socket.emit("fireworks",JSON.stringify(e)),fireworkCounter>fireworkLimit?(fireworkCounter=0,document.getElementById("fireworks-btn").disabled=!0,document.getElementById("fireworks-btn").innerText="Bắn chậm thôi !",setTimeout(()=>{document.getElementById("fireworks-btn").disabled=!1,document.getElementById("fireworks-btn").innerText="Bắn 1 quả pháo 🧨"},5e3)):fireworkCounter++});